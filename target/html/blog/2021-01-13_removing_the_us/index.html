<!doctype html>
<html lang=en>
    <head>
        <link href='data:image/png;base64,R0lGODlhGAAYAOeIAAAAALVSwLlUxLxXyLlZxMlb1cpc1hScoRSepNBf3c9h29Rg4NJh39Nh4BWhps9j3NJi3s1k2dVh4tBk3NVi4tNj39Zi49di49di5NBl3NVj4tNk39hi5dZj49Zj5Nli5dRk4ddj5NVk4thj5dti5tNl4Nhj5tZk49Fm3tlj5dRl4Nlj5tdk49dk5Npj5ddk5dVl4dhk5dZl49lk5tdl5dpk5tZm49Nn5NVn4tVn5dZn49Ro4Nlm5tNo5ddn5NBq29Vo4dVo4haortln5dRp4Ndo49Zp49Nq5Raqr9pp59hr5NFu5Nls5s1y5BevtBawtcp25BizuRi1uhm4vi20wbqG4hm7wRq8whm9w7yI4raM4Bq/xRq/xrSO4RrByBrDyRvDyhvFyxvGzBvHzRvHzqeb4BvIzhvIzxzIzxvJz6ad4CTH0aKf3xzK0BzK0RzL0p6i3xzN1BzP1R3P1pGr3h3Q15Or3RzR2CPP2R3R2B3R2R/R2RzS2R3S2SfP2Yex3Yey3TPN2TbN2Xm43DDP2Xa63EXK2kbK2v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////yH+B2hhaSBoYWkAIfkEAQoA/wAsAAAAABgAGAAACP4A/wkcSLCgwYMFASgEgLDhQiFWrkxZ2JAgACl58vTZuDGPwor/ALzhyFEMmI1uGCIEUKfPHABkODoAMGZjHZUJ02wEEAUARwBofNrEOVBoH5EAzuyMA0Djxi9EAXD5mWdOS5JYo2Ld+pNjGpUAEGwVmrLPlqMkwSLhCgAqAgAHjG40wxCAE656ADzBQwWAHz5ZQ2LhashOlR4uSOToAkjQz5BesB5ic4QHiyQyiFiokQJKoZ8ATnIctCQGBCYqRHjYoWPIihUvyhA6CiDMxj10aFhI8MBGhghBZnTg8fp1FkIKa/aBk2LFhQUlbOAoooHDiRbFX2tR2EbPnw+vR0NMMAJEAQwQFBpoCDFCgoCFAOQEapJ9Q5EKDFCUKPKDAPyid6hhQnZK+GDAAPARVdQaN7yGQQEB/AdSSAlOaOGFAgUEADs=' 
        rel=icon>
        <title>Jojolepro.com</title>
        <meta charset=utf-8>
        <meta name=description content="A bunch of stuff and things!">
        <style>
            body{
                text-align:center;
                overflow-y:scroll;
                /*font:calc(0.75em + 1vmin) monospace;*/
                font: 1.3em monospace;
                background-color: #181a1b;
                border-color: #575757;
                color: #e8e6e3;
            }
            pre{
                text-align:left;
                display:inline-block;
            }
            img{
                max-width:80ch;
                display:block;
                height:auto;
                width:100%;
            }
            nav a {
                margin-right: 1ch;
            }
            a {
                color: #3391ff;
            }
            * {
                scrollbar-color: #2a2c2e #1c1e1f;
            }
        </style>
    </head>
    <body>
        <nav>
            <a href=/><b>Jojolepro</b></a>
            <br/>
            <a href=/blog>Blog</a>
            <a href=/quotes>Quotes</a>
            <a href=/projects>Projects</a>
            <!--<a href=/focks>Focks</a>-->
            <a href=https://git.jojolepro.com>Git</a>
            <a href=https://github.com/jojolepro/>GitHub</a>
        </nav>
        <br/>
        <article>
            <pre>
Getting Rid of The US
================================================================================
Or that one time I tried living without access to servers in or owned by
US-based companies.

We all know that the US has a lot of influence over the world. The same is true
on the internet. As an experiment, I decided to add block all ip addresses from
the US, as well as all ip addresses from companies based in the US.

The Method
--------------------------------------------------------------------------------
I downloaded the major IP blocks allocated to the US from here:
<a href='https://www.nirsoft.net/countryip/us.csv'>https://www.nirsoft.net/countryip/us.csv</a>

Then, I used this list to get the names of the richest (and by extent, likely
more present on the internet) companies:
<a href='https://en.wikipedia.org/wiki/List_of_largest_companies_by_revenue'>https://en.wikipedia.org/wiki/List_of_largest_companies_by_revenue</a>

Using this list, I used a service called SecurityTrails to get all subdomains
they own. From there, I got the 200 highest ranked subdomains for each of those
companies.

Finally, I used an old /etc/hosts file containing domains of ad providers and
of various suspicious websites.

I combined this old host file with the one containing the subdomains.
Then, I placed this new file as my /etc/hosts, where all those subdomains point
to the ip address 0.0.0.0.

As for the ip ranges, I used ip tables.
First, I made a backup using
# iptables-save &gt; ~/iptables_bkp
which can be restored using
# iptables-restore &lt; ~/iptables_bkp

Then, in you can add all the ip ranges in iptables.
while IFS="" read -r range; do
    sudo iptables -I INPUT -s "$range" -j DROP &amp;&amp; echo "$range"
done &lt; ips

First Observations
--------------------------------------------------------------------------------
The first thing I observed after applying these changes was that discord, steam,
github and duckduckgo were still all working.

This is because they have servers that are outside of the US and they weren't
included in the list of domains we removed. So, I added those to the list of
subdomains.

This does point out to a systematic issue however: a *ton* of websites and
services that are US-based have  servers outside of it. Moreover, they rarely
specify that they are from the US. To find this out, you often need to go into
their terms of services and search for either their address or mentions
of the United States. That is, when they have terms of services.

Finally, I took the cloudflare ip addresses from here: 
<a href='https://www.cloudflare.com/ips/'>https://www.cloudflare.com/ips/</a>
and removed them. This is the moment the internet broke.

What Works?
--------------------------------------------------------------------------------

My weather radar still works. This is expected as it fetches data from
the Canadian government website, which host their things themselves.
Trying to go to the actual website <a href='https://weather.gc.ca,'>https://weather.gc.ca,</a> however, will fail.
That is, until you reload the page. Then, the content will magically appear.
Each time you change to a new page, you have to reload it to get firefox unstuck
from whatever it is trying to fetch (mostly google services).

While this website is visible, I would rate it as unusable.

Now, let's check my newsboat. I have a bunch of websites in there, so we'll see
which ones work. Obviously, youtube will not work.
Drew DeVault's blog works fine, which is a pleasant surprise.
Codemadness and dataswamp.org also both seem to work.
Same with the Kiss Linux blog. Sadly, it has been inactive for a few months.
The Arch Linux news updates also works.

So, overall, most of my newsfeed, excluding youtube, work.

Next, my emails. I have a mail server in France, so this works just fine too.

The tor browser works fine, which means it could be used to access services that
can't be accessed otherwise in a 'somewhat protected way'. A bit like wearing
a condom while entering the... virulent US climate, let's say.

For chatting, discord is out of the question, so I ssh'd into my server and
booted the matrix server.

..Just to realize that I don't have a matrix client installed.
However, the good news is that I had non-US mirrors enabled for pacman, which
means I can just install element-desktop.
It works!

Now, there are couple more things that need to be checked. Mostly, the things
related to the school I attend to and the things I need for my work.

First, the school website. It worked on the first try, without any issue.
Not only is this extremely surprising, but even more surprising is the fact that
it loads extremely fast compared to the usual.
Actually, scratch everything I say, because at the second I cleared the browser
cache, it refused to load.
Yep, now it's dead for good. Looking in the network tab, I see that it wants to
load fonts from googleapis.com and load some content from instagram's CDN.
We really never know what websites can be doing in the background if we don't
check, heh?
This will be a job for tor.

Now, concerning my job. I program, rust, which uses libraries hosted on
crates.io, which itself uses Amazon's aws to store the files. That's a bad
start, but maybe not the end of the world. I already know how to locally
download and use those libraries. All I need to do, is fetch the ones I need
ahead of time, then use them. Except, in practice, that rarely works well.
I tried self-hosting a part of the libraries, and there were always missing
ones. This means that not only I would probably need to download and keep
more of them on a disk, but I would also need to keep downloading the newest
version of those libraries.
Also, my work requires me to use github, which is already in the exclusion
list.
Ouch!
            </pre>
        </article>
        <br/>
        <footer>
            <div>
                (C) JoÃ«l Lupien 2020-2021
            </div>
            <a href="/blog/2021-01-13_removing_the_us/index.txt">View page source</a>
        </footer>
    </body>
</html>
